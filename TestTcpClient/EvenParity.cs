using System.Linq;

namespace TestTcpClient
{
    public static class EvenParity
    {
        private static readonly byte[] ParityLookup = {
            // 0    1    2    3    4    5    6    7    8    9    A    B    C    D    E    F
            0x00,0x81,0x82,0x03,0x84,0x05,0x06,0x87,0x88,0x09,0x0a,0x8b,0x0c,0x8d,0x8e,0x0f,
            0x90,0x11,0x12,0x93,0x14,0x95,0x96,0x17,0x18,0x99,0x9a,0x1b,0x9c,0x1d,0x1e,0x9f,
            0xa0,0x21,0x22,0xa3,0x24,0xa5,0xa6,0x27,0x28,0xa9,0xaa,0x2b,0xac,0x2d,0x2e,0xaf,
            0x30,0xb1,0xb2,0x33,0xb4,0x35,0x36,0xb7,0xb8,0x39,0x3a,0xbb,0x3c,0xbd,0xbe,0x3f,
            0xc0,0x41,0x42,0xc3,0x44,0xc5,0xc6,0x47,0x48,0xc9,0xca,0x4b,0xcc,0x4d,0x4e,0xcf,
            0x50,0xd1,0xd2,0x53,0xd4,0x55,0x56,0xd7,0xd8,0x59,0x5a,0xdb,0x5c,0xdd,0xde,0x5f,
            0x60,0xe1,0xe2,0x63,0xe4,0x65,0x66,0xe7,0xe8,0x69,0x6a,0xeb,0x6c,0xed,0xee,0x6f,
            0xf0,0x71,0x72,0xf3,0x74,0xf5,0xf6,0x77,0x78,0xf9,0xfa,0x7b,0xfc,0x7d,0x7e,0xff
        };

        public static byte[] Set(byte[] message)
        {
            return message.Select(Set).ToArray();
        }

        public static byte[] Unset(byte[] message)
        {
            return message.Select(Unset).ToArray();
        }

        public static byte Unset(byte value)
        {
            return (byte)(value & 0x7F);
        }

        public static byte Set(byte value)
        {
            return ParityLookup[value];
        }
    }
}